<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuickDraw Messenger</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            overflow: hidden;
            height: 100vh;
        }

        .app {
            display: flex;
            flex-direction: column;
            height: 100vh;
            max-width: 100%;
            margin: 0 auto;
            background: white;
        }

        /* Header */
        .header {
            padding: 12px 16px;
            background: #4285f4;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .header-title {
            font-size: 18px;
            font-weight: 600;
        }

        .header-actions {
            display: flex;
            gap: 8px;
        }

        .header-btn {
            padding: 8px 12px;
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
        }

        /* Canvas */
        .canvas-area {
            flex: 1;
            position: relative;
            overflow: hidden;
            background: #f8f9fa;
        }

        #drawingCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: block;
            cursor: crosshair;
        }

        /* Tools */
        .tools-panel {
            padding: 12px 16px;
            background: white;
            border-top: 1px solid #e0e0e0;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-items: center;
        }

        .tool-group {
            display: flex;
            gap: 4px;
            padding: 4px;
            background: #f5f5f5;
            border-radius: 8px;
        }

        .tool-btn {
            padding: 8px 12px;
            border: none;
            background: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.2s;
        }

        .tool-btn.active {
            background: #4285f4;
            color: white;
        }

        .color-palette {
            display: flex;
            gap: 4px;
        }

        .color-btn {
            width: 32px;
            height: 32px;
            border: 2px solid transparent;
            border-radius: 50%;
            cursor: pointer;
        }

        .color-btn.active {
            border-color: #333;
            transform: scale(1.1);
        }

        .size-control {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .size-btn {
            width: 24px;
            height: 24px;
            border: 2px solid #ddd;
            border-radius: 50%;
            background: #333;
            cursor: pointer;
        }

        .size-btn.small { transform: scale(0.7); }
        .size-btn.medium { transform: scale(1); }
        .size-btn.large { transform: scale(1.3); }

        .size-btn.active {
            border-color: #4285f4;
        }

        /* Background selector */
        .background-selector {
            display: flex;
            gap: 4px;
        }

        .bg-btn {
            padding: 8px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            background: white;
            cursor: pointer;
            font-size: 14px;
        }

        .bg-btn.active {
            border-color: #4285f4;
            background: #4285f4;
            color: white;
        }

        /* Actions */
        .actions-panel {
            padding: 12px 16px;
            background: white;
            border-top: 1px solid #e0e0e0;
            display: flex;
            gap: 8px;
            justify-content: space-between;
        }

        .action-btn {
            flex: 1;
            padding: 12px 16px;
            border: none;
            border-radius: 8px;
            background: #4285f4;
            color: white;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .action-btn.secondary {
            background: #f5f5f5;
            color: #333;
        }

        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 20px;
            max-width: 90%;
            width: 400px;
            max-height: 80%;
            overflow-y: auto;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
        }

        .modal-actions {
            display: flex;
            gap: 8px;
            margin-top: 20px;
        }

        /* Share options */
        .share-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .share-option {
            padding: 16px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.2s;
        }

        .share-option:hover {
            border-color: #4285f4;
            background: #f8f9fe;
        }

        .share-icon {
            font-size: 24px;
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 14px;
            z-index: 2000;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .notification.show {
            opacity: 1;
        }

        /* Responsive */
        @media (max-width: 480px) {
            .tools-panel {
                flex-direction: column;
                align-items: stretch;
            }
            
            .tool-group {
                justify-content: center;
            }
            
            .actions-panel {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="app">
        <!-- Header -->
        <div class="header">
            <div class="header-title">QuickDraw Messenger</div>
            <div class="header-actions">
                <button class="header-btn" id="clearBtn">–û—á–∏—Å—Ç–∏—Ç—å</button>
                <button class="header-btn" id="undoBtn">–ù–∞–∑–∞–¥</button>
            </div>
        </div>

        <!-- Canvas Area -->
        <div class="canvas-area">
            <canvas id="drawingCanvas"></canvas>
        </div>

        <!-- Tools Panel -->
        <div class="tools-panel">
            <div class="tool-group">
                <button class="tool-btn active" data-tool="brush" title="–ö–∏—Å—Ç—å">üñåÔ∏è</button>
                <button class="tool-btn" data-tool="eraser" title="–õ–∞—Å—Ç–∏–∫">üßπ</button>
                <button class="tool-btn" data-tool="line" title="–õ–∏–Ω–∏—è">üìè</button>
                <button class="tool-btn" data-tool="rect" title="–ü—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫">‚¨ú</button>
                <button class="tool-btn" data-tool="circle" title="–ö—Ä—É–≥">‚≠ï</button>
            </div>

            <div class="color-palette">
                <div class="color-btn active" style="background: #000000;" data-color="#000000"></div>
                <div class="color-btn" style="background: #ff3b30;" data-color="#ff3b30"></div>
                <div class="color-btn" style="background: #4cd964;" data-color="#4cd964"></div>
                <div class="color-btn" style="background: #007aff;" data-color="#007aff"></div>
                <div class="color-btn" style="background: #5856d6;" data-color="#5856d6"></div>
                <div class="color-btn" style="background: #ff9500;" data-color="#ff9500"></div>
            </div>

            <div class="size-control">
                <div class="size-btn small active" data-size="2"></div>
                <div class="size-btn medium" data-size="5"></div>
                <div class="size-btn large" data-size="10"></div>
            </div>

            <div class="background-selector">
                <button class="bg-btn active" data-bg="white">–ë–µ–ª—ã–π</button>
                <button class="bg-btn" data-bg="grid">–°–µ—Ç–∫–∞</button>
                <button class="bg-btn" data-bg="lined">–õ–∏–Ω–æ–≤–∫–∞</button>
            </div>
        </div>

        <!-- Actions Panel -->
        <div class="actions-panel">
            <button class="action-btn secondary" id="saveBtn">
                üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
            </button>
            <button class="action-btn" id="shareBtn">
                üì§ –ü–æ–¥–µ–ª–∏—Ç—å—Å—è
            </button>
        </div>

        <!-- Share Modal -->
        <div class="modal" id="shareModal">
            <div class="modal-content">
                <div class="modal-title">–ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Ä–∏—Å—É–Ω–∫–æ–º</div>
                <div class="share-options">
                    <div class="share-option" data-action="download">
                        <div class="share-icon">üíæ</div>
                        <div>
                            <div class="share-title">–°–∫–∞—á–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</div>
                            <div class="share-desc">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å PNG –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ</div>
                        </div>
                    </div>
                    <div class="share-option" data-action="copy">
                        <div class="share-icon">üìã</div>
                        <div>
                            <div class="share-title">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤ –±—É—Ñ–µ—Ä</div>
                            <div class="share-desc">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏</div>
                        </div>
                    </div>
                    <div class="share-option" data-action="telegram">
                        <div class="share-icon">üì±</div>
                        <div>
                            <div class="share-title">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ Telegram</div>
                            <div class="share-desc">–ü–æ–¥–µ–ª–∏—Ç—å—Å—è —á–µ—Ä–µ–∑ Telegram</div>
                        </div>
                    </div>
                </div>
                <div class="modal-actions">
                    <button class="action-btn secondary" id="closeShareModal">–û—Ç–º–µ–Ω–∞</button>
                </div>
            </div>
        </div>

        <!-- Notification -->
        <div class="notification" id="notification"></div>
    </div>

    <script>
        // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let canvas, ctx;
        let isDrawing = false;
        let lastX = 0, lastY = 0;
        let startX = 0, startY = 0;
        let currentTool = 'brush';
        let currentColor = '#000000';
        let currentSize = 2;
        let currentBackground = 'white';
        let savedImageData = null;
        
        // –ò—Å—Ç–æ—Ä–∏—è –¥–µ–π—Å—Ç–≤–∏–π
        let history = [];
        let historyIndex = -1;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        function init() {
            console.log('üé® –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è QuickDraw Messenger...');
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è canvas
            canvas = document.getElementById('drawingCanvas');
            ctx = canvas.getContext('2d');
            
            setupCanvas();
            setupEventListeners();
            setupBackground();
            saveState();
            
            console.log('‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ!');
            showNotification('QuickDraw Messenger –∑–∞–≥—Ä—É–∂–µ–Ω!');
        }

        function setupCanvas() {
            // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–∞–∑–º–µ—Ä–æ–≤ canvas
            const container = canvas.parentElement;
            const rect = container.getBoundingClientRect();
            
            canvas.width = rect.width;
            canvas.height = rect.height;
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ç–∏–ª–µ–π —Ä–∏—Å–æ–≤–∞–Ω–∏—è
            ctx.lineJoin = 'round';
            ctx.lineCap = 'round';
            ctx.lineWidth = currentSize;
            ctx.strokeStyle = currentColor;
            
            console.log('üìê Canvas –Ω–∞—Å—Ç—Ä–æ–µ–Ω:', canvas.width, 'x', canvas.height);
        }

        function setupEventListeners() {
            // –°–æ–±—ã—Ç–∏—è –º—ã—à–∏
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);
            
            // –°–æ–±—ã—Ç–∏—è –∫–∞—Å–∞–Ω–∏—è
            canvas.addEventListener('touchstart', handleTouchStart);
            canvas.addEventListener('touchmove', handleTouchMove);
            canvas.addEventListener('touchend', stopDrawing);
            
            // –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
            document.querySelectorAll('.tool-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    selectTool(e.target.closest('.tool-btn').dataset.tool);
                });
            });
            
            // –¶–≤–µ—Ç–∞
            document.querySelectorAll('.color-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    selectColor(e.target.closest('.color-btn').dataset.color);
                });
            });
            
            // –†–∞–∑–º–µ—Ä—ã
            document.querySelectorAll('.size-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    selectSize(parseInt(e.target.closest('.size-btn').dataset.size));
                });
            });
            
            // –§–æ–Ω—ã
            document.querySelectorAll('.bg-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    selectBackground(e.target.closest('.bg-btn').dataset.bg);
                });
            });
            
            // –î–µ–π—Å—Ç–≤–∏—è
            document.getElementById('clearBtn').addEventListener('click', clearCanvas);
            document.getElementById('undoBtn').addEventListener('click', undo);
            document.getElementById('saveBtn').addEventListener('click', saveImage);
            document.getElementById('shareBtn').addEventListener('click', openShareModal);
            document.getElementById('closeShareModal').addEventListener('click', closeShareModal);
            
            // –û–ø—Ü–∏–∏ —à–∞—Ä–∏–Ω–≥–∞
            document.querySelectorAll('.share-option').forEach(option => {
                option.addEventListener('click', (e) => {
                    const action = e.target.closest('.share-option').dataset.action;
                    handleShareAction(action);
                });
            });
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
            window.addEventListener('resize', debounce(setupCanvas, 250));
        }

        function handleTouchStart(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent('mousedown', {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            canvas.dispatchEvent(mouseEvent);
        }

        function handleTouchMove(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent('mousemove', {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            canvas.dispatchEvent(mouseEvent);
        }

        function getCanvasCoordinates(e) {
            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;
            
            return {
                x: (e.clientX - rect.left) * scaleX,
                y: (e.clientY - rect.top) * scaleY
            };
        }

        function startDrawing(e) {
            isDrawing = true;
            const coords = getCanvasCoordinates(e);
            [lastX, lastY] = [coords.x, coords.y];
            [startX, startY] = [coords.x, coords.y];
            
            if (['line', 'rect', 'circle'].includes(currentTool)) {
                savedImageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            }
            
            if (currentTool === 'brush' || currentTool === 'eraser') {
                ctx.beginPath();
                ctx.moveTo(lastX, lastY);
            }
        }

        function draw(e) {
            if (!isDrawing) return;
            
            const coords = getCanvasCoordinates(e);
            const currentX = coords.x;
            const currentY = coords.y;
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ç–∏–ª—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
            if (currentTool === 'eraser') {
                ctx.globalCompositeOperation = 'destination-out';
                ctx.strokeStyle = 'rgba(0,0,0,1)';
            } else {
                ctx.globalCompositeOperation = 'source-over';
                ctx.strokeStyle = currentColor;
            }
            
            ctx.lineWidth = currentSize;
            
            switch(currentTool) {
                case 'brush':
                case 'eraser':
                    ctx.lineTo(currentX, currentY);
                    ctx.stroke();
                    break;
                    
                case 'line':
                    ctx.putImageData(savedImageData, 0, 0);
                    ctx.beginPath();
                    ctx.moveTo(startX, startY);
                    ctx.lineTo(currentX, currentY);
                    ctx.stroke();
                    break;
                    
                case 'rect':
                    ctx.putImageData(savedImageData, 0, 0);
                    ctx.strokeRect(startX, startY, currentX - startX, currentY - startY);
                    break;
                    
                case 'circle':
                    ctx.putImageData(savedImageData, 0, 0);
                    const radius = Math.sqrt(Math.pow(currentX - startX, 2) + Math.pow(currentY - startY, 2));
                    ctx.beginPath();
                    ctx.arc(startX, startY, radius, 0, 2 * Math.PI);
                    ctx.stroke();
                    break;
            }
            
            [lastX, lastY] = [currentX, currentY];
        }

        function stopDrawing() {
            if (isDrawing) {
                isDrawing = false;
                ctx.globalCompositeOperation = 'source-over';
                
                if (currentTool !== 'brush') {
                    saveState();
                }
                
                savedImageData = null;
            }
        }

        function selectTool(tool) {
            currentTool = tool;
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
            document.querySelectorAll('.tool-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-tool="${tool}"]`).classList.add('active');
            
            showNotification(`–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç: ${getToolName(tool)}`);
        }

        function selectColor(color) {
            currentColor = color;
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
            document.querySelectorAll('.color-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-color="${color}"]`).classList.add('active');
            
            ctx.strokeStyle = color;
        }

        function selectSize(size) {
            currentSize = size;
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
            document.querySelectorAll('.size-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-size="${size}"]`).classList.add('active');
            
            ctx.lineWidth = size;
        }

        function selectBackground(bg) {
            currentBackground = bg;
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
            document.querySelectorAll('.bg-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-bg="${bg}"]`).classList.add('active');
            
            setupBackground();
            saveState();
        }

        function setupBackground() {
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–π —Ä–∏—Å—É–Ω–æ–∫
            const currentDrawing = history.length > 0 ? history[historyIndex] : null;
            
            // –û—á–∏—â–∞–µ–º canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–æ–Ω
            switch(currentBackground) {
                case 'white':
                    ctx.fillStyle = '#ffffff';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    break;
                    
                case 'grid':
                    drawGridBackground();
                    break;
                    
                case 'lined':
                    drawLinedBackground();
                    break;
            }
            
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∏—Å—É–Ω–æ–∫
            if (currentDrawing) {
                ctx.putImageData(currentDrawing, 0, 0);
            }
        }

        function drawGridBackground() {
            // –ë–µ–ª—ã–π —Ñ–æ–Ω
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // –°–µ—Ç–∫–∞
            ctx.strokeStyle = '#e0e0e0';
            ctx.lineWidth = 1;
            
            const gridSize = 20;
            
            // –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏
            for (let x = 0; x < canvas.width; x += gridSize) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, canvas.height);
                ctx.stroke();
            }
            
            // –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏
            for (let y = 0; y < canvas.height; y += gridSize) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
            }
        }

        function drawLinedBackground() {
            // –ë–µ–ª—ã–π —Ñ–æ–Ω
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // –õ–∏–Ω–æ–≤–∫–∞
            ctx.strokeStyle = '#87CEEB';
            ctx.lineWidth = 1;
            
            const lineSpacing = 24;
            
            for (let y = lineSpacing; y < canvas.height; y += lineSpacing) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
            }
        }

        function getToolName(tool) {
            const names = {
                'brush': '–ö–∏—Å—Ç—å',
                'eraser': '–õ–∞—Å—Ç–∏–∫',
                'line': '–õ–∏–Ω–∏—è',
                'rect': '–ü—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫',
                'circle': '–ö—Ä—É–≥'
            };
            return names[tool] || tool;
        }

        // –ò—Å—Ç–æ—Ä–∏—è –¥–µ–π—Å—Ç–≤–∏–π
        function saveState() {
            const state = ctx.getImageData(0, 0, canvas.width, canvas.height);
            
            // –û–±—Ä–µ–∑–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
            if (historyIndex < history.length - 1) {
                history = history.slice(0, historyIndex + 1);
            }
            
            history.push(state);
            historyIndex++;
            
            // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä –∏—Å—Ç–æ—Ä–∏–∏
            if (history.length > 50) {
                history.shift();
                historyIndex--;
            }
        }

        function restoreState() {
            if (historyIndex >= 0) {
                const state = history[historyIndex];
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                setupBackground();
                ctx.putImageData(state, 0, 0);
            } else {
                // –ï—Å–ª–∏ –∏—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞, –ø—Ä–æ—Å—Ç–æ –æ—á–∏—â–∞–µ–º canvas
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                setupBackground();
            }
        }

        function undo() {
            if (historyIndex > 0) {
                historyIndex--;
                restoreState();
                showNotification('–î–µ–π—Å—Ç–≤–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ');
            } else if (historyIndex === 0) {
                historyIndex = -1;
                restoreState();
                showNotification('–î–µ–π—Å—Ç–≤–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ');
            }
        }

        function clearCanvas() {
            if (confirm('–û—á–∏—Å—Ç–∏—Ç—å —Ö–æ–ª—Å—Ç? –í—Å–µ –Ω–µ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –±—É–¥—É—Ç –ø–æ—Ç–µ—Ä—è–Ω—ã.')) {
                historyIndex = -1;
                history = [];
                restoreState();
                showNotification('–•–æ–ª—Å—Ç –æ—á–∏—â–µ–Ω');
            }
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ —à–∞—Ä–∏–Ω–≥
        function saveImage() {
            const link = document.createElement('a');
            link.download = `quickdraw-${Date.now()}.png`;
            link.href = canvas.toDataURL('image/png');
            link.click();
            showNotification('–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ');
        }

        function openShareModal() {
            document.getElementById('shareModal').classList.add('active');
        }

        function closeShareModal() {
            document.getElementById('shareModal').classList.remove('active');
        }

        function handleShareAction(action) {
            switch(action) {
                case 'download':
                    saveImage();
                    break;
                    
                case 'copy':
                    copyToClipboard();
                    break;
                    
                case 'telegram':
                    shareToTelegram();
                    break;
            }
            
            closeShareModal();
        }

        async function copyToClipboard() {
            try {
                const blob = await new Promise(resolve => canvas.toBlob(resolve, 'image/png'));
                await navigator.clipboard.write([new ClipboardItem({ 'image/png': blob })]);
                showNotification('–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ –≤ –±—É—Ñ–µ—Ä');
            } catch (err) {
                showNotification('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è');
                console.error('Copy error:', err);
            }
        }

        function shareToTelegram() {
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram API
            // –î–ª—è –¥–µ–º–æ –ø—Ä–æ—Å—Ç–æ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            saveImage();
            showNotification('–§—É–Ω–∫—Ü–∏—è Telegram –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ –ø–æ–ª–Ω–æ–π –≤–µ—Ä—Å–∏–∏');
        }

        // –£—Ç–∏–ª–∏—Ç—ã
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        function showNotification(message, duration = 3000) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, duration);
        }

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>